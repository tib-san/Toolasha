name: Format Release Please

on:
    pull_request:

permissions:
    contents: write
    pull-requests: write

jobs:
    format-release-notes:
        if: startsWith(github.head_ref, 'release-please--')
        runs-on: ubuntu-latest

        steps:
            - name: Checkout code
              uses: actions/checkout@v6
              with:
                  ref: ${{ github.head_ref }}
                  token: ${{ secrets.GITHUB_TOKEN }}

            - name: Setup Node.js
              uses: actions/setup-node@v6
              with:
                  node-version: '20'
                  cache: 'npm'

            - name: Install dependencies
              run: npm ci

            - name: Sync version across files
              run: npm run version:sync

            - name: Run formatting
              run: npm run format

            - name: Commit formatted changes
              run: |
                  if git diff --quiet; then
                    echo "No formatting changes to commit."
                    exit 0
                  fi

                  git config user.name "github-actions[bot]"
                  git config user.email "github-actions[bot]@users.noreply.github.com"
                  git add -A
                  git commit -m "chore: sync version and format release notes"
                  git push
